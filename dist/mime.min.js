(function(){var e;e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t,n){var r,u,o,a,i,c,d,s,l;for(l="",r=void 0,u=void 0,o=void 0,a=void 0,i=void 0,c=void 0,d=void 0,s=0,n&&(t=e._utf8_encode(t));s<t.length;)r=t.charCodeAt(s++),u=t.charCodeAt(s++),o=t.charCodeAt(s++),a=r>>2,i=(3&r)<<4|u>>4,c=(15&u)<<2|o>>6,d=63&o,isNaN(u)?c=d=64:isNaN(o)&&(d=64),l=l+this._keyStr.charAt(a)+this._keyStr.charAt(i)+this._keyStr.charAt(c)+this._keyStr.charAt(d);return l},decode:function(t,n){var r,u,o,a,i,c,d,s,l;for(l="",r=void 0,u=void 0,o=void 0,a=void 0,i=void 0,c=void 0,d=void 0,s=0,t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<t.length;)a=this._keyStr.indexOf(t.charAt(s++)),i=this._keyStr.indexOf(t.charAt(s++)),c=this._keyStr.indexOf(t.charAt(s++)),d=this._keyStr.indexOf(t.charAt(s++)),r=a<<2|i>>4,u=(15&i)<<4|c>>2,o=(3&c)<<6|d,l+=String.fromCharCode(r),64!==c&&(l+=String.fromCharCode(u)),64!==d&&(l+=String.fromCharCode(o));return n&&(l=e._utf8_decode(l)),l},_utf8_encode:function(e){var t,n,r;for(e=e.replace(/\r\n/g,"\n"),r="",n=0;n<e.length;)t=e.charCodeAt(n),128>t?r+=String.fromCharCode(t):t>127&&2048>t?(r+=String.fromCharCode(t>>6|192),r+=String.fromCharCode(63&t|128)):(r+=String.fromCharCode(t>>12|224),r+=String.fromCharCode(t>>6&63|128),r+=String.fromCharCode(63&t|128)),n++;return r},_utf8_decode:function(e){var t,n,r,u,o,a;for(a="",o=0,t=n=r=0;o<e.length;)t=e.charCodeAt(o),128>t?(a+=String.fromCharCode(t),o++):t>191&&224>t?(r=e.charCodeAt(o+1),a+=String.fromCharCode((31&t)<<6|63&r),o+=2):(r=e.charCodeAt(o+1),u=e.charCodeAt(o+2),a+=String.fromCharCode((15&t)<<12|(63&r)<<6|63&u),o+=3);return a}},window.Mime=function(){var t,n,r,u,o;return o=function(t,n){var r,u,o,a,i,c,d,s,l,f,h,g,m,p,C,y;return m=function(e){var t,n,r,u;return t=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,u=e.replace(t,'<a href="$1" target="_blank">$1</a>'),n=/(^|[^\/])(www\.[\S]+(\b|$))/gim,u=u.replace(n,'$1<a href="http://$2" target="_blank">$2</a>'),r=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,u=u.replace(r,'<a href="mailto:$1">$1</a>')},h=function(){var e;return e=function(){return Math.random().toString(36).slice(2)},e()+e()},l=function(t){return null==t&&(t=""),"\nContent-Type: text/plain; charset=UTF-8\nContent-Transfer-Encoding: base64\n\n"+e.encode(t,!0).replace(/.{76}/g,"$&\n")},d=function(t){var n;return n=t.body||"",n="<div>"+n+"</div>","\nContent-Type: text/html; charset=UTF-8\nContent-Transfer-Encoding: base64\n\n"+e.encode(n,!0).replace(/.{76}/g,"$&\n")},a=function(e,t){var n;return n=h(),"\nContent-Type: multipart/alternative; boundary="+n+"\n\n--"+n+e+"\n\n--"+n+t+"\n\n--"+n+"--"},c=function(e){var t,n,r,u,o,a,i,c;if(e){for(r=[],o=0,a=e.length;a>o;o++)n=e[o],c=n.type,i=n.name,t=n.base64,u=n.id,r.push("\nContent-Type: "+c+'; name="'+i+'"\nContent-Transfer-Encoding: base64\nContent-ID: <'+u+">\nX-Attachment-Id: "+u+"\n\n"+t);return r}},f=function(e,t){var n,r,u,o,a;for(null==t&&(t=[]),n=h(),a="\nContent-Type: multipart/related; boundary="+n+"\n\n--"+n+e,u=0,o=t.length;o>u;u++)r=t[u],a+="\n--"+n+r;return a+"\n--"+n+"--"},i=function(e){var t,n,r,u,o,a,i,c;if(e){for(i=[],u=0,o=e.length;o>u;u++)t=e[u],c=t.type,a=t.name,n=t.base64,r=h(),i.push("\nContent-Type: "+c+'; name="'+a+'"\nContent-Disposition: attachment; filename="'+a+'"\nContent-Transfer-Encoding: base64\nX-Attachment-Id: '+r+"\n\n"+n);return i}},s=function(n,r){var u,o,a,i,c,d,s,l;for(o=h(),l="",t.subject&&(l="=?UTF-8?B?"+e.encode(t.subject,!0)+"?="),d="=?UTF-8?B?"+e.encode(t.fromName||"",!0)+"?=",a=(new Date).toGMTString().replace(/GMT|UTC/gi,"+0000"),s="MIME-Version: 1.0\nDate: "+a+"\nMessage-ID: <"+h()+"@mail.your-domain.com>\nSubject: "+l+"\nFrom: "+d+" <"+t.from+">"+(t.to?"\nTo: "+t.to:"")+(t.cc?"\nCc: "+t.cc:"")+"\nContent-Type: multipart/mixed; boundary="+o+"\n\n--"+o+n,i=0,c=r.length;c>i;i++)u=r[i],s+="\n--"+o+u;return(s+"\n--"+o+"--").replace(/\n/g,"\r\n")},p=l(t.body),n?C=p:(g=d(t),r=a(p,g),o=c(t.cids),C=f(r,o)),u=i(t.attaches),y=s(C,u)},t=function(e){var t,r,u,o,a,i,c,d;r=function(e){var t,u,o,a,i,c,d,s,l,f,h,g,m,p,C,y;if(s=e.indexOf("\r\n\r\n"),-1===s&&(e=e.replace(/\n/g,"\r\n"),s=e.indexOf("\r\n\r\n"),-1===s&&(s=e.length)),f=e.slice(0,s).replace(/\r\n\s+/g," ")+"\r\n",l=e.slice(s).replace(/(\r\n)+$/,"").replace(/^(\r\n)+/,""),c="",p=f.match(/Content-Type: (.*)/i),p&&p.length>0?c=p[1]:console.log("Warning: MailParser: Content-type doesn't exist!"),d=c.split(";"),g=d[0].replace(/\s/g,""),m=g.split("/"),"multipart"===m[0].toLowerCase())for(a=[],h=d[1].match(/boundary="?([^"]*)"?/i),!h&&d[2]&&(h=d[2].match(/boundary="?([^"]*)"?/i)),i=n.trim(h[1]).replace(/"/g,""),t=i.replace(/\+/g,"\\+"),C=new RegExp("--"+t,"g"),a=l.replace(C,i).replace(C,i).split(i),a.shift(),a.pop(),u=0;u<a.length;)a[u]=a[u].replace(/(\r\n)+$/,"").replace(/^(\r\n)+/,""),a[u]=r(a[u]),u++;else if(o=l,"text"===m[0]&&(o=o.replace(RegExp("=\\r\\n","g"),""),y=o.match(RegExp("=[A-F0-9][A-F0-9]","g"))))for(u=0;u<y.length;)o=o.replace(y[u],String.fromCharCode(parseInt(y[u].replace(RegExp("="),""),16))),u++;return{rawHeaders:f,rawBody:l,body:o,contentType:c,contentTypeParts:d,boundary:i,bodyParts:a,mimeType:g,mimeTypeParts:m}},a="";try{a=r(e)}catch(s){}return i=a.rawHeaders,o=function(e){return null==e&&(e=[]),e[1]||""},c=o(/\r\nSubject: (.*)\r\n/g.exec(i)),d=o(/\r\nTo: (.*)\r\n/g.exec(i)),t=o(/\r\nCc: (.*)\r\n/g.exec(i)),u=o(/\r\nFrom: (.*)\r\n/g.exec(i)),{messageParts:a,subject:c,to:d,cc:t,from:u}},n=function(){var t,r,u,o,a,i,c,d;return c=function(e){return null==e&&(e=""),("function"==typeof e.trim?e.trim():void 0)||e.replace(/^\s+|\s+$/g,"")},o=function(n,r){var u;return null==n&&(n=""),null==r&&(r=""),r=r.toLowerCase(),u=function(){switch(!1){case-1===r.indexOf("koi8-r"):return t(n);case-1===r.indexOf("utf-8"):return e._utf8_decode(n);case-1===r.indexOf("windows-1251"):return d(n);default:return n}}()},r=function(e){return e.replace(/\=[\r\n]+/g,"").replace(/\=[0-9A-F]{2}/gi,function(e){return String.fromCharCode(parseInt(e.substr(1),16))})},t=function(e){var t,n,r,u,o,a,i;for(t=unescape("%u2500%u2502%u250C%u2510%u2514%u2518%u251C%u2524%u252C%u2534%u253C%u2580%u2584%u2588%u258C%u2590%u2591%u2592%u2593%u2320%u25A0%u2219%u221A%u2248%u2264%u2265%u00A0%u2321%u00B0%u00B2%u00B7%u00F7%u2550%u2551%u2552%u0451%u2553%u2554%u2555%u2556%u2557%u2558%u2559%u255A%u255B%u255C%u255D%u255E%u255F%u2560%u2561%u0401%u2562%u2563%u2564%u2565%u2566%u2567%u2568%u2569%u256A%u256B%u256C%u00A9%u044E%u0430%u0431%u0446%u0434%u0435%u0444%u0433%u0445%u0438%u0439%u043A%u043B%u043C%u043D%u043E%u043F%u044F%u0440%u0441%u0442%u0443%u0436%u0432%u044C%u044B%u0437%u0448%u044D%u0449%u0447%u044A%u042E%u0410%u0411%u0426%u0414%u0415%u0424%u0413%u0425%u0418%u0419%u041A%u041B%u041C%u041D%u041E%u041F%u042F%u0420%u0421%u0422%u0423%u0416%u0412%u042C%u042B%u0417%u0428%u042D%u0429%u0427%u042A"),n=function(e){return e>=128&&255>=e?t.charAt(e-128):String.fromCharCode(e)},a="",r=u=0,o=e.length;o>u;r=++u)i=e[r],a+=n(e.charCodeAt(r));return a},d=function(e){var t,n,r,u,o,a,i;for(null==e&&(e=""),a="",t=r=0,u=e.length;u>r;t=++r)i=e[t],n=e.charCodeAt(t),o=function(){switch(!1){case 168!==n:return 1025;case 184!==n:return 1105;case!(n>191&&256>n):return n+848;default:return n}}(),a+=String.fromCharCode(o);return a},u=function(t,u){var a,i,c;return t=n.trim(t),i=void 0,a=void 0,c=void 0,(c=t.match(/^\=\?([\w_\-]+)\?([QqBb])\?([^\?]*)\?\=$/i))?(i=c[1],a=(c[2]||"Q").toString().toUpperCase(),t=(c[3]||"").replace(/_/g," "),"B"===a?e.decode(t,u):"Q"===a?r(t):t):o(t,u)},a=function(e,t){return e=(e||"").toString().replace(/(=\?[^?]+\?[QqBb]\?[^?]+\?=)\s+(?==\?[^?]+\?[QqBb]\?[^?]*\?=)/g,"$1").replace(/\=\?([\w_\-]+)\?([QqBb])\?[^\?]*\?\=/g,function(e,t,n){return u(e)}.bind(this)),o(e,t)},i=function(e){return null==e&&(e=""),(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},{decode:o,KOIRDec:t,win1251Dec:d,decodeMimeWords:a,toHtmlEntity:i,trim:c}}(),r=function(r){var o,a,i,c,d,s,l,f,h,g,m,p,C;m={html:"",text:"",attaches:[],innerMsgs:[],to:n.decodeMimeWords(r.to),cc:n.decodeMimeWords(r.cc),from:n.decodeMimeWords(r.from),subject:n.decodeMimeWords(r.subject)},a=function(t,r){var u,o,a;return a=/Content-Transfer-Encoding: quoted-printable/i.test(r),o=/Content-Transfer-Encoding: base64/i.test(r),o?(t=t.replace(/\s/g,""),u="function"==typeof atob?atob(t):void 0,null==u&&(u=e.decode(t)),t=u):a&&(t=n.QPDec(t)),t},h=function(r){var o,i,c,d,s,l,f,g,p,C,y,v,b,x,A,T,S,w,_,E,M,B,O,D,F;if(r){for(C=0,v=r.length;v>C;C++)if(S=r[C],x=(null!=(_=S.mimeType)?_:"").toLowerCase(),-1===x.indexOf("multipart"))if(-1===x.indexOf("message/rfc822"))if(w=S.rawHeaders,d=-1!==w.indexOf("Content-Disposition: attachment"),i=S.rawBody,l=/text\/html/.test(x),g=/text\/plain/.test(x),f=/image/.test(x),s=/audio/.test(x),d||f||s){for(p=/Content-Transfer-Encoding: quoted-printable/i.test(w),p&&(i=n.QPDec(i),i=btoa?btoa(i):e.encode(i)),E=S.contentTypeParts,y=0,b=E.length;b>y;y++)if(F=E[y],/name=/i.test(F)){A=F.replace(/(.*)=/,"").replace(/"|'/g,"");break}A||(A=f?"image":s?"audio":"attachment",A+="_"+Math.floor(100*Math.random()),O=x.indexOf("/"),D=x.substring(O+1),D.length<4&&(A+="."+D)),B=/(.*)content-id:(.*)<(.*)>/i,o={type:x,base64:i,name:A,cid:null!=(M=B.exec(w))?M[3]:void 0,visible:/png|jpeg|jpg|gif/.test(x)},m.attaches.push(o)}else l||g?(i=a(i,w),i=n.decode(i,S.contentType),l&&(m.html+=i),g&&(m.text+=i)):console.log("Unknown mime type: "+x);else T=t(S.rawBody),c=u(T),m.innerMsgs.push(c);else h(S.bodyParts);return null}};try{if(g=r.messageParts,!g)return m;f=(g.mimeType||"").toLowerCase(),s=/text\/plain/.test(f),d=/text\/html/.test(f),-1!==f.indexOf("multipart")?h(g.bodyParts):s||d?(o=a(g.body,g.rawHeaders),o=n.decode(o,g.contentType),d&&(m.html=o),s&&(m.text=o)):console.log("Warning: mime type isn't supported! mime="+f)}catch(c){throw i=c,new Error(i)}return C=function(e){return"<pre>"+n.toHtmlEntity(e)+"</pre>"},l=function(e){var t,r,u,o,a,i,c,d;if(u=e.innerMsgs,null!=u?u.length:void 0)for(!n.trim(e.html)&&e.text&&(e.html+=C(e.text)),o=0,a=u.length;a>o;o++)r=u[o],i=l(r),d=i.text,t=i.html,t?e.html+=t:d&&(e.html+=wrapPerTag(d),e.text+=d),(null!=(c=i.attaches)?c.length:void 0)>0&&(e.attaches=e.attaches.concat(i.attaches));return e},p=l(m)},u=function(e){var n,u;return u=t(e),n=r(u)},{toMimeTxt:o,toMimeObj:u}}()}).call(this);